<?php
use Symfony\Component\Console\Output\NullOutput;

/**
 * @file
 * Performs searches to the Cultuurnet api.
 *
 * @todo
 * - Fix the function culturefeed_agenda_activity_recommend_link so that the function
 *   "culturefeed_ui_block_users_recommends_config" is moved to correct place
 *
 */

module_load_include('inc', 'culturefeed_agenda', 'includes/helpers');

/**
 * Implements hook_theme().
 */
function culturefeed_agenda_theme() {

  $theme = array();
  $path = drupal_get_path('module', 'culturefeed_agenda') . '/theme';
  $item_types = array('event', 'production', 'actor');

  foreach ($item_types as $type) {

    $theme['culturefeed_' . $type . '_summary'] = array(
      'variables' => array('item' => NULL),
      'template' => 'culturefeed-' . $type . '-summary',
      'path' => $path,
      'file' => 'theme.inc',
    );

    $theme['culturefeed_' . $type] = array(
      'variables' => array('item' => NULL),
      'template' => 'culturefeed-' . $type,
      'path' => $path,
      'file' => 'theme.inc',
    );

  }

  return $theme;

}

/**
 * Implements hook_menu().
 */
function culturefeed_agenda_menu() {

  $items = array();

  // Menu path for detail pages.
  $items['agenda/a/%/%culturefeed_agenda_actor'] = array(
    'title callback' => 'culturefeed_agenda_detail_title',
    'title arguments' => array(3),
    'page callback' => 'culturefeed_agenda_detail_page',
    'page arguments' => array(3),
    'access arguments' => array('access content'),
    'type' => MENU_CALLBACK,
    'file' => 'includes/pages.inc',
  );

  $items['agenda/e/%/%culturefeed_agenda_event'] = array(
    'title callback' => 'culturefeed_agenda_detail_title',
    'title arguments' => array(3),
    'page callback' => 'culturefeed_agenda_detail_page',
    'page arguments' => array(3),
    'access arguments' => array('access content'),
    'type' => MENU_CALLBACK,
    'file' => 'includes/pages.inc',
  );

  $items['agenda/p/%/%culturefeed_agenda_production'] = array(
    'title callback' => 'culturefeed_agenda_detail_title',
    'title arguments' => array(3),
    'page callback' => 'culturefeed_agenda_detail_page',
    'page arguments' => array(3),
    'access arguments' => array('access content'),
    'type' => MENU_CALLBACK,
    'file' => 'includes/pages.inc',
  );

  return $items;

}

/**
 * Implements hook_culturefeed_search_page_info().
 */
function culturefeed_agenda_culturefeed_search_page_info() {
  return array(
    'activiteiten' => array(
      'path' => 'agenda/search',
      'page_title' => 'Agenda',
      'search_title' => 'Activiteiten',
      'class_name' => 'CultureFeedAgendaPage',
    ),
  );
}

/**
 * Title callback for agenda detail pages.
 */
function culturefeed_agenda_detail_title(\CultuurNet\Search\ActivityStatsExtendedEntity $item) {

  global $language;
  $details = $item->getEntity()->getDetails()->getDetailByLanguage($language->language);

  if ($details) {
    return $details->getTitle();
  }

}

/**
 * Load an event from the api.
 */
function culturefeed_agenda_event_load($cdb_id) {
  return culturefeed_search_item_load($cdb_id);
}

/**
 * Load an actor from the api.
 */
function culturefeed_agenda_actor_load($cdb_id) {
  return culturefeed_search_item_load($cdb_id);
}

/**
 * Load a production from the api.
 */
function culturefeed_agenda_production_load($cdb_id) {
  return culturefeed_search_item_load($cdb_id);
}
